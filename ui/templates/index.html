<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremsy 카메라 & 짐벌 컨트롤러</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- HLS.js 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎥 Gremsy Controller</h1>
            <div class="status">
                <span id="connection-status" class="status-indicator">연결 상태 확인 중...</span>
                <span id="robot-ip">Robot IP: {{ robot_ip }}</span>
            </div>
        </header>

        <div class="main-content">
            <!-- 카메라 스트림 섹션 -->
            <div class="stream-section">
                <h2>📹 카메라 스트림</h2>
                <div class="stream-tabs">
                    <button class="tab-btn active" onclick="switchStream('hls')">HLS 스트림</button>
                    <button class="tab-btn" onclick="switchStream('webrtc')">WebRTC 스트림</button>
                </div>
                
                <div class="video-container">
                    <!-- HLS 비디오 플레이어 -->
                    <video id="hls-player" class="video-player active" controls autoplay muted playsinline>
                        브라우저가 HLS를 지원하지 않습니다.
                    </video>
                    
                    <!-- WebRTC 비디오 플레이어 -->
                    <video id="webrtc-player" class="video-player" controls autoplay muted playsinline>
                        브라우저가 WebRTC를 지원하지 않습니다.
                    </video>
                    
                    <!-- 스트림이 로드되지 않을 때 표시 -->
                    <div id="stream-placeholder" class="stream-placeholder">
                        <div class="loading-spinner"></div>
                        <p>스트림 연결 중...</p>
                    </div>
                    
                    <div class="stream-info">
                        <div class="stream-urls">
                            <p><strong>HLS URL:</strong> <code id="hls-url">http://{{ robot_ip }}:8888/gremsy/index.m3u8</code></p>
                            <p><strong>WebRTC URL:</strong> <code id="webrtc-url">http://{{ robot_ip }}:8889/gremsy</code></p>
                            <p><strong>원본 RTSP:</strong> <code id="rtsp-url">{{ rtsp_url }}</code></p>
                        </div>
                        <div class="stream-controls">
                            <button onclick="refreshStream()">🔄 스트림 새로고침</button>
                            <button onclick="openExternalPlayer()">📱 외부 플레이어로 열기</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 짐벌 컨트롤 섹션 -->
            <div class="control-section">
                <h2>🎮 짐벌 컨트롤</h2>
                
                <!-- 방향키 컨트롤 -->
                <div class="gimbal-controls">
                    <div class="direction-pad">
                        <button class="dir-btn up" onmousedown="startMove('pitch', 10)" onmouseup="stopMove()">▲</button>
                        <div class="middle-row">
                            <button class="dir-btn left" onmousedown="startMove('yaw', -10)" onmouseup="stopMove()">◄</button>
                            <button class="dir-btn center" onclick="stopMove()">⏹</button>
                            <button class="dir-btn right" onmousedown="startMove('yaw', 10)" onmouseup="stopMove()">►</button>
                        </div>
                        <button class="dir-btn down" onmousedown="startMove('pitch', -10)" onmouseup="stopMove()">▼</button>
                    </div>
                </div>

                <!-- 속도 조절 -->
                <div class="speed-control">
                    <label for="speed-slider">이동 속도: <span id="speed-value">10</span>°/s</label>
                    <input type="range" id="speed-slider" min="1" max="50" value="10" oninput="updateSpeed(this.value)">
                </div>

                <!-- 카메라 설정 -->
                <div class="camera-settings">
                    <h3>🎨 카메라 설정</h3>
                    
                    <div class="setting-group">
                        <label for="ir-palette">IR 팔레트:</label>
                        <select id="ir-palette" onchange="changeIRPalette(this.value)">
                            <option value="1">팔레트 1</option>
                            <option value="2">팔레트 2</option>
                            <option value="3">팔레트 3</option>
                            <option value="4">팔레트 4</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="view-src">뷰소스:</label>
                        <select id="view-src" onchange="changeViewSrc(this.value)">
                            <option value="1">소스 1</option>
                            <option value="2">소스 2</option>
                            <option value="3">소스 3</option>
                            <option value="4">소스 4</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- 로그 섹션 -->
        <div class="log-section">
            <h3>📋 활동 로그</h3>
            <div id="activity-log"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>